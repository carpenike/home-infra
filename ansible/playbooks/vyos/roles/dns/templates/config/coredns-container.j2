#jinja2: lstrip_blocks: "True", trim_blocks: "True"
{%- from "macros/config.j2" import generate_config -%}

{%- if coredns['enabled'] -%}
  {%- set coredns_container_config = {
    'allow-host-networks': {},
    'image': (coredns['container']['repository'] + ':' + coredns['container']['tag']),
    'volume': {
      'config_folder': {
        'source': coredns['config_path'],
        'destination': '/config'
      },
      'hosts': {
        'source': '/etc/hosts',
        'destination': '/etc/hosts'
      }
    }
  } -%}

  {{- generate_config(current_config, coredns_container_config, ['container', 'name', 'coredns']) -}}
{%- else -%}
  {# Remove the key if coredns is disabled -#}
  delete container coredns
{%- endif -%}
